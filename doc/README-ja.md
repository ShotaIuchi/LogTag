# LogTag

LogTag は、ログメッセージにタグを追加するためのツールです。指定されたファイルからログメッセージを読み込み、タグを追加し、必要に応じてソートや重複削除を行います。

## 特徴

- 複数のログファイルを結合
- ログメッセージにタグを追加
- ログメッセージをソート
- 重複するログメッセージを削除
- 設定ファイルによる柔軟なカスタマイズ
- タグのマッチングに正規表現対応

## インストール

### PyPI からインストール

**TODO:** このパッケージはまだ PyPI に登録されていません。

```sh
pip install logtag
```

### ローカルインストール

このスクリプトをローカルにインストールするには、以下のコマンドを使用してください。

```sh
pip install -e .
```

## 使用方法

次のようにスクリプトを実行します。

```sh
logtag [files] -o [output_file] [options]
```

### 引数

- `files`: 処理する 1 つ以上のログファイルを指定します。ワイルドカードも使用可能です（例：`*.txt`で全ての`.txt`ファイルにマッチ）。

### オプション

- `-c`, `--category`: 1 つ以上のタグカテゴリを指定し、ログメッセージをフィルタリングします。指定しない場合は、全てのカテゴリが使用されます。
- `-o`, `--out`: 出力ファイルを指定します。指定しない場合、結果は標準出力に表示されます。
- `-s`, `--sort`: ログメッセージを内容でソートします。
- `-u`, `--uniq`: 重複するログメッセージを削除し、一意のメッセージのみを保持します。
- `--hidden`: 隠しログメッセージを表示します。デフォルトでは隠しメッセージは表示されません。
- `--config`: `config.hjson`やタグファイルを含むカスタム設定ディレクトリを指定します。

## 設定ファイル

設定ファイルは HJSON 形式で記述されており、JSON よりも柔軟でコメントを記述できます。以下のような構成です。

### `config.hjson`

```json
{
  "column": [
    { "name": "TAG", "display": "Tag", "enable": true },
    { "name": "CATEGORY", "display": "Category", "enable": true },
    { "name": "FILE", "display": "File", "enable": true },
    { "name": "LOG", "display": "Log Message", "enable": true }
  ]
}
```

- `column`: 出力時に表示する列とその設定（表示名、列の有効/無効など）を指定します。

### タグファイル (`logtag.hjson`)

```json
{
  "ERROR": "エラー検出",
  "INFO": "情報メッセージ",
  "^WARN.*": "警告メッセージ"
}
```

- タグは、特定のキーワードと対応するメッセージを定義します。これらのキーワードがログに出現すると、対応するメッセージがタグとして追加されます。
- **正規表現**もサポートされています。例えば、`^WARN.*`は"WARN"で始まるすべてのログメッセージにマッチします。

### ディレクトリ構造

ツールは以下の優先順位で設定ファイルを検索します。

1. コマンドラインで指定されたディレクトリ
2. カレントワーキングディレクトリ
3. ユーザーのホームディレクトリ
4. スクリプトが存在するディレクトリ

## 使用例

次の例では、ログファイルにタグを追加し、ログメッセージをソートし、重複を削除し、結果を`output.txt`に出力します。ワイルドカード（`*.txt`）を使用して複数のファイルをマッチさせることが可能です。

```sh
python logtag.py *.txt -o output.txt --sort --uniq --config ./config
```

このコマンドはカレントディレクトリ内のすべての`.txt`ファイルを読み込み、タグを追加し、ソートし、重複を削除した結果を`output.txt`に出力します。`--config`でカスタム設定ディレクトリを指定した場合、そのディレクトリ内の`config.hjson`と`logtag.hjson`が使用されます。
